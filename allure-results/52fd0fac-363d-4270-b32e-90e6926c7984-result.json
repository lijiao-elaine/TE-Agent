{"name": "执行测试用例: XXX_TEST_002", "status": "failed", "statusDetails": {"message": "Failed: 用例执行过程中发生异常: 用例 XXX_TEST_002 执行失败（结果：不通过。部分用例步骤执行时出现异常或截图失败）\n  错误详情:\n  第2步的被测程序执行时的xterm终端截图失败\nassert '不通过。部分用例步骤执行时出现异常或截图失败' == '通过'\n  \n  \u001b[0m\u001b[91m- 通过\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\n  \u001b[92m+ 不通过。部分用例步骤执行时出现异常或截图失败\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\nTraceback (most recent call last):\n  File \"/home/root7/code/TE-Agent/main.py\", line 190, in test_run_case\n    assert overall_result == \"通过\", f\"用例 {test_case['case_id']} 执行失败（结果：{overall_result}）\\n错误详情:\\n{error_details}\"\nAssertionError: 用例 XXX_TEST_002 执行失败（结果：不通过。部分用例步骤执行时出现异常或截图失败）\n  错误详情:\n  第2步的被测程序执行时的xterm终端截图失败\nassert '不通过。部分用例步骤执行时出现异常或截图失败' == '通过'\n  \n  \u001b[0m\u001b[91m- 通过\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\n  \u001b[92m+ 不通过。部分用例步骤执行时出现异常或截图失败\u001b[39;49;00m\u001b[90m\u001b[39;49;00m", "trace": "case_path = '/home/root7/code/TE-Agent/test_cases/unit_test/module_3/XXX_TEST_002.json', init_test_session = None, batch = 1\n\n    @allure.epic(\"测试用例执行\")\n    @allure.feature(\"批量用例执行\")\n    def test_run_case(case_path, init_test_session, batch):\n        \"\"\"pytest批量执行测试用例\"\"\"\n        global SHELL_SCRIPT_EXECUTED\n        shell_script = os.getenv(\"SHELL_SCRIPT_PATH\", \"\")\n    \n        # 标记存在第二批用例\n        if batch == 2:\n            os.environ[\"BATCH_2_EXIST_FLAG\"] = \"True\"  # 写入环境变量\n    \n        # 执行完第一批次的单元测试用例后，执行全流程脚本\n        if batch == 2 and not SHELL_SCRIPT_EXECUTED and shell_script:\n            batch2_cases = os.getenv(\"BATCH2_TEST_CASES\", \"\").split(\";\")\n            filtered_cases = [case for case in batch2_cases if case]\n            clear_full_process_logfile(filtered_cases) # 在执行全流程脚本前，将所有用例需要检查的日志都清理掉，确保全流程用例检查的日志都是跑全流程生成的\n    \n            print(f\"\\n===== 开始执行全流程shell脚本：{shell_script} =====\")\n            try:\n                run_full_process_script(shell_script)\n                time.sleep(20)  # 延迟20秒，确保全流程脚本执行完成\n            except Exception as e:\n                print(f\"执行全流程脚本异常：{str(e)}\")\n                pytest.fail(\"全流程脚本执行失败，终止后续用例\")\n            SHELL_SCRIPT_EXECUTED = True\n    \n        try:\n            case_name = Path(case_path).stem\n            allure.dynamic.title(f\"执行测试用例: {case_name}\")\n            allure.dynamic.description(f\"用例文件路径: {case_path}\")\n            case_manager = TestCaseManager()\n    \n            with allure.step(\"加载测试用例\"):\n                case_path_obj = Path(case_path)\n                test_case = case_manager.load_test_case(case_path_obj)\n                test_case[\"_source_path\"] = str(case_path_obj)\n    \n                # 在报告中附 用例基本信息\n                allure.attach(\n                    f\"用例名称: {case_name}\\n\"\n                    f\"文件路径: {case_path}\",\n                    \"用例基本信息\",\n                    allure.attachment_type.TEXT\n                )\n    \n            with allure.step(\"工作流执行测试用例\"):\n                agent = TestExecuteAgent()\n                final_state = agent.run(test_case)\n    \n            with allure.step(\"验证测试结果\"):\n            # 断言用例结果\n                error_details = \"\\n\".join(final_state['errors']) if final_state['errors'] else \"无错误\"\n                overall_result = final_state['case_result'].get(\"overall_result\", \"未知\")\n    \n    \n                result_info = {\n                    \"用例名称\": {case_name},\n                    \"执行结果\": overall_result,\n                    \"错误数量\": len(final_state.get('errors', [])),\n                    \"错误详情\": error_details\n                }\n    \n                # 在报告中附 用例执行结果\n                allure.attach(\n                    str(result_info),\n                    \"测试执行结果\",\n                    allure.attachment_type.JSON\n                )\n    \n                if overall_result == \"通过\":\n                    allure.dynamic.severity(allure.severity_level.NORMAL)\n                else:\n                    allure.dynamic.severity(allure.severity_level.CRITICAL)\n    \n            #print(f\"用例 {test_case.get('case_id')} 执行结果：{overall_result}\")\n>           assert overall_result == \"通过\", f\"用例 {test_case['case_id']} 执行失败（结果：{overall_result}）\\n错误详情:\\n{error_details}\"\nE           AssertionError: 用例 XXX_TEST_002 执行失败（结果：不通过。部分用例步骤执行时出现异常或截图失败）\nE             错误详情:\nE             第2步的被测程序执行时的xterm终端截图失败\nE           assert '不通过。部分用例步骤执行时出现异常或截图失败' == '通过'\nE             \nE             \u001b[0m\u001b[91m- 通过\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\nE             \u001b[92m+ 不通过。部分用例步骤执行时出现异常或截图失败\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\n\nmain.py:190: AssertionError\n\nDuring handling of the above exception, another exception occurred:\n\ncase_path = '/home/root7/code/TE-Agent/test_cases/unit_test/module_3/XXX_TEST_002.json', init_test_session = None, batch = 1\n\n    @allure.epic(\"测试用例执行\")\n    @allure.feature(\"批量用例执行\")\n    def test_run_case(case_path, init_test_session, batch):\n        \"\"\"pytest批量执行测试用例\"\"\"\n        global SHELL_SCRIPT_EXECUTED\n        shell_script = os.getenv(\"SHELL_SCRIPT_PATH\", \"\")\n    \n        # 标记存在第二批用例\n        if batch == 2:\n            os.environ[\"BATCH_2_EXIST_FLAG\"] = \"True\"  # 写入环境变量\n    \n        # 执行完第一批次的单元测试用例后，执行全流程脚本\n        if batch == 2 and not SHELL_SCRIPT_EXECUTED and shell_script:\n            batch2_cases = os.getenv(\"BATCH2_TEST_CASES\", \"\").split(\";\")\n            filtered_cases = [case for case in batch2_cases if case]\n            clear_full_process_logfile(filtered_cases) # 在执行全流程脚本前，将所有用例需要检查的日志都清理掉，确保全流程用例检查的日志都是跑全流程生成的\n    \n            print(f\"\\n===== 开始执行全流程shell脚本：{shell_script} =====\")\n            try:\n                run_full_process_script(shell_script)\n                time.sleep(20)  # 延迟20秒，确保全流程脚本执行完成\n            except Exception as e:\n                print(f\"执行全流程脚本异常：{str(e)}\")\n                pytest.fail(\"全流程脚本执行失败，终止后续用例\")\n            SHELL_SCRIPT_EXECUTED = True\n    \n        try:\n            case_name = Path(case_path).stem\n            allure.dynamic.title(f\"执行测试用例: {case_name}\")\n            allure.dynamic.description(f\"用例文件路径: {case_path}\")\n            case_manager = TestCaseManager()\n    \n            with allure.step(\"加载测试用例\"):\n                case_path_obj = Path(case_path)\n                test_case = case_manager.load_test_case(case_path_obj)\n                test_case[\"_source_path\"] = str(case_path_obj)\n    \n                # 在报告中附 用例基本信息\n                allure.attach(\n                    f\"用例名称: {case_name}\\n\"\n                    f\"文件路径: {case_path}\",\n                    \"用例基本信息\",\n                    allure.attachment_type.TEXT\n                )\n    \n            with allure.step(\"工作流执行测试用例\"):\n                agent = TestExecuteAgent()\n                final_state = agent.run(test_case)\n    \n            with allure.step(\"验证测试结果\"):\n            # 断言用例结果\n                error_details = \"\\n\".join(final_state['errors']) if final_state['errors'] else \"无错误\"\n                overall_result = final_state['case_result'].get(\"overall_result\", \"未知\")\n    \n    \n                result_info = {\n                    \"用例名称\": {case_name},\n                    \"执行结果\": overall_result,\n                    \"错误数量\": len(final_state.get('errors', [])),\n                    \"错误详情\": error_details\n                }\n    \n                # 在报告中附 用例执行结果\n                allure.attach(\n                    str(result_info),\n                    \"测试执行结果\",\n                    allure.attachment_type.JSON\n                )\n    \n                if overall_result == \"通过\":\n                    allure.dynamic.severity(allure.severity_level.NORMAL)\n                else:\n                    allure.dynamic.severity(allure.severity_level.CRITICAL)\n    \n            #print(f\"用例 {test_case.get('case_id')} 执行结果：{overall_result}\")\n            assert overall_result == \"通过\", f\"用例 {test_case['case_id']} 执行失败（结果：{overall_result}）\\n错误详情:\\n{error_details}\"\n        except Exception as e:\n            # 记录异常信息到 Allure\n            allure.attach(\n                traceback.format_exc(),\n                \"异常堆栈信息\",\n                allure.attachment_type.TEXT\n            )\n            allure.dynamic.severity(allure.severity_level.BLOCKER)\n            #print(f\"用例执行异常：{str(e)}\\n{traceback.format_exc()}\")\n>           pytest.fail(f\"用例执行过程中发生异常: {str(e)}\\n{traceback.format_exc()}\")\nE           Failed: 用例执行过程中发生异常: 用例 XXX_TEST_002 执行失败（结果：不通过。部分用例步骤执行时出现异常或截图失败）\nE             错误详情:\nE             第2步的被测程序执行时的xterm终端截图失败\nE           assert '不通过。部分用例步骤执行时出现异常或截图失败' == '通过'\nE             \nE             \u001b[0m\u001b[91m- 通过\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\nE             \u001b[92m+ 不通过。部分用例步骤执行时出现异常或截图失败\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\nE           Traceback (most recent call last):\nE             File \"/home/root7/code/TE-Agent/main.py\", line 190, in test_run_case\nE               assert overall_result == \"通过\", f\"用例 {test_case['case_id']} 执行失败（结果：{overall_result}）\\n错误详情:\\n{error_details}\"\nE           AssertionError: 用例 XXX_TEST_002 执行失败（结果：不通过。部分用例步骤执行时出现异常或截图失败）\nE             错误详情:\nE             第2步的被测程序执行时的xterm终端截图失败\nE           assert '不通过。部分用例步骤执行时出现异常或截图失败' == '通过'\nE             \nE             \u001b[0m\u001b[91m- 通过\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\nE             \u001b[92m+ 不通过。部分用例步骤执行时出现异常或截图失败\u001b[39;49;00m\u001b[90m\u001b[39;49;00m\n\nmain.py:200: Failed"}, "description": "用例文件路径: /home/root7/code/TE-Agent/test_cases/unit_test/module_3/XXX_TEST_002.json", "steps": [{"name": "加载测试用例", "status": "passed", "attachments": [{"name": "用例基本信息", "source": "85e5ff17-09fe-4ccb-aad1-be168d6be823-attachment.txt", "type": "text/plain"}], "start": 1761878200106, "stop": 1761878200107}, {"name": "工作流执行测试用例", "status": "passed", "start": 1761878200107, "stop": 1761878208095}, {"name": "验证测试结果", "status": "passed", "attachments": [{"name": "测试执行结果", "source": "32abcab3-0d42-4087-a4cc-d3cc3964206a-attachment.json", "type": "application/json"}], "start": 1761878208096, "stop": 1761878208097}], "attachments": [{"name": "异常堆栈信息", "source": "12c1b9dd-fe65-4eb9-a9b2-7102e801e595-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "9494b51c-b063-4287-bab9-97d46ebd2b69-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "case_path", "value": "'/home/root7/code/TE-Agent/test_cases/unit_test/module_3/XXX_TEST_002.json'"}, {"name": "batch", "value": "1"}], "start": 1761878200106, "stop": 1761878208103, "uuid": "1811f3c5-ef53-47d8-894c-734a5f9a1903", "historyId": "509567ff1272ec67d08b6c2de5e478df", "testCaseId": "4ff731e6ff9237e27ae4db122faa2ce4", "fullName": "main#test_run_case", "labels": [{"name": "severity", "value": "critical"}, {"name": "severity", "value": "blocker"}, {"name": "epic", "value": "测试用例执行"}, {"name": "feature", "value": "批量用例执行"}, {"name": "tag", "value": "batch1"}, {"name": "suite", "value": "main"}, {"name": "host", "value": "ThinkStation-PX"}, {"name": "thread", "value": "47778-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "main"}], "titlePath": ["main.py"]}